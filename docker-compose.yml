version: "3"

services:
    minio1:
        image: minio/minio:RELEASE.2020-12-03T05-49-24Z
        # volumes:
        #   - data1-1:/data1
        #   - data1-2:/data2
        expose:
            - "9000"
        environment:
            MINIO_ACCESS_KEY: minio
            MINIO_SECRET_KEY: minio123
        ports:
        - '9000:9000'
        networks:
            - predix-edge-broker_net
        command: server /data
        # healthcheck:
        #     test: ["CMD", "curl", "-f", "http://localhost:9000/minio/health/live"]
        #     interval: 30s
        #     timeout: 20s
        #     retries: 3
    predix-edge-broker:
        image: "toke/mosquitto"
        networks:
            - predix-edge-broker_net
    grpc-server-app:
        build:
            context: ./
            dockerfile: Dockerfile
            args:
              http_proxy: $http_proxy
              https_proxy: $http_proxy
              no_proxy: $no_proxy
        image: "testgrpc"
        networks:
            - predix-edge-broker_net
        deploy:
            resources:
                limits:
                    cpus: '0.5'
                    memory: 50M
        command: ["/testGrpcServer"]
        depends_on:
            - "predix-edge-broker"
    grpc-client-app:
        image: "testgrpc"
        # environment:
        #     config: "/config/config.json"
        networks:
            - predix-edge-broker_net
        deploy:
            resources:
                limits:
                    cpus: '0.5'
                    memory: 50M
        networks:
            - predix-edge-broker_net
        depends_on:
            - "grpc-server-app"
        command: ["/testGrpcClient"]
    mqtt-app:
        image: "testgrpc"
        networks:
            - predix-edge-broker_net
        deploy:
            resources:
                limits:
                    cpus: '0.5'
                    memory: 50M
        networks:
            - predix-edge-broker_net
        depends_on:
            - "grpc-server-app"
        command: ["/mqttApp"]

networks:
  predix-edge-broker_net:
    external: true
